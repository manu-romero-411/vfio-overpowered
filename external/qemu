#!/usr/bin/env bash
#
# Author: manu_romero_411
#
# Copy this file to /etc/libvirt/hooks, make sure it's called "qemu".
# After this file is installed, restart libvirt.
# From now on, you can easily add per-guest qemu hooks.
# Add your hooks in /etc/libvirt/hooks/qemu.d/vm_name/hook_name/state_name.
# For a list of available hooks, please refer to https://www.libvirt.org/hooks.html
#
#set -x
GUEST_NAME="$1"
STATE_NAME="$3"
MISC="${@:4}"

if [ -z $1 ] || [ -z $2 ] || [ -z $3 ]; then
	echo "[ERROR] Argumento inv√°lido"
	echo "Uso: $0 <vm-name> <prepare|start|started|stopped|release> <begin|end>"
	exit 1
fi

#echo $1 $2 $3 >> /pcgrande/Escritorio/aaa.log

/bin/bash -x /usr/local/etc/vfio/vfio_overpower.sh "$GUEST_NAME" "$2" "$3" "$4"

#if [[ $3 == "begin" ]] && [[ $2 == "prepare" ]]; then
#	/bin/bash -x /usr/local/etc/vfio/vfio_overpower.sh $GUEST_NAME prepare begin
#elif [[ $3 == "begin" ]] && [[ $2 == "start" ]]; then
#	/bin/bash -x /usr/local/etc/vfio/vfio_overpower.sh $GUEST_NAME start begin
#elif [[ $3 == "begin" ]] && [[ $2 == "started" ]]; then
#	/bin/bash -x /usr/local/etc/vfio/vfio_overpower.sh "$GUEST_NAME" started begin
#elif [[ $3 == "end" ]] && [[ $2 == "stopped" ]]; then
#	/bin/bash -x /usr/local/etc/vfio/vfio_overpower.sh "$GUEST_NAME" release stopped
#elif [[ $3 == "end" ]] && [[ $2 == "release" ]]; then
#	/bin/bash -x /usr/local/etc/vfio/vfio_overpower.sh "$GUEST_NAME" release end "$4"
#fi
