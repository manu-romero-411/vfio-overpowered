#!/bin/bash
function error(){
	RED='\033[1;31m'
	NC='\033[0m'
	printf "${RED}[ERROR] $@ ${NC}\n"
}

function check_root() {
	if [ $(id -u) -ne 0 ]; then
		error "No eres root"
		exit 1
	fi
}

function help_dialog(){
        echo "USO: [sudo] $0 <nombre-vm> [--edit-config | --edit-hooks]"
}

check_root

if [ -z $1 ]; then
	error "Falta un argumento"
	help_dialog
	exit 1
fi

if ! virsh --connect qemu:///system list --all --name | grep -w "$1" >/dev/null && [[ "$1" != "global" ]]; then
	error "La m√°quina virtual $1 no existe. Prueba con:"
	virsh list --all --name
	exit 1
fi

case "$2" in
	"--edit-config"|"--editconfig"|"--editconf"|"-c") ARG="--editconfig" ;;
	"--edit-hooks"|"--edithooks"|"--edit-hook"|"--edithook"|"-h") ARG="--edithook" ;;
	"--help"|"-h") help_dialog "$@"; exit 0;;
	*) error "Falta un argumento"; help_dialog "$@"; exit 1;;
esac

python /usr/local/etc/vfio/scripts/aux_/config_utils.py "$1" "${ARG}"
exit $?
